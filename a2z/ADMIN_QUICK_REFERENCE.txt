ADMIN USER SYSTEM - QUICK REFERENCE CARD
=========================================

QUICK START:
============

1. Start Application:
   ./mvnw spring-boot:run

   Look for startup logs:
   "✓ Admin user created successfully"
   "Username: admin"

2. Login as Admin:
   curl -X POST http://localhost:8080/api/admin/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"admin@12345"}'

   Response will contain "token" and "scope": "app.write"

3. Create New Admin:
   curl -X POST http://localhost:8080/api/admin/create-user \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer YOUR_TOKEN_HERE" \
     -d '{
       "username":"newadmin",
       "password":"Secure@Pass123",
       "email":"admin@example.com",
       "firstName":"John",
       "lastName":"Doe",
       "phoneNumber":"+1234567890"
     }'


ENDPOINTS:
==========

PUBLIC (No Auth Required):
  POST   /api/admin/login                 → Admin direct login
  GET    /api/admin/health                → Health check

PROTECTED (Requires ROLE_ADMIN):
  POST   /api/admin/create-user           → Create new admin user


REQUEST/RESPONSE EXAMPLES:
==========================

LOGIN:
------
Request:
  POST /api/admin/login
  Content-Type: application/json

  {
    "username": "admin",
    "password": "admin@12345"
  }

Response (200 OK):
  {
    "success": true,
    "token": "eyJhbGciOiJIUzI1NiIsInR...",
    "username": "admin",
    "email": "admin@a2z.local",
    "scope": "app.write",
    "message": "Admin authenticated successfully",
    "timestamp": 1674567890123
  }

Response (401 Unauthorized):
  {
    "success": false,
    "message": "Invalid username or password",
    "timestamp": 1674567890123
  }


CREATE ADMIN USER:
------------------
Request:
  POST /api/admin/create-user
  Content-Type: application/json
  Authorization: Bearer <token_from_login>

  {
    "username": "newadmin",
    "password": "SecurePass@123",
    "email": "newadmin@a2z.com",
    "firstName": "John",
    "lastName": "Doe",
    "phoneNumber": "+1234567890"
  }

Response (201 Created):
  {
    "username": "newadmin",
    "email": "newadmin@a2z.com",
    "firstName": "John",
    "lastName": "Doe",
    "message": "Admin user created successfully",
    "success": true
  }

Response (400 Bad Request):
  {
    "username": "newadmin",
    "email": "newadmin@a2z.com",
    "firstName": "John",
    "lastName": "Doe",
    "message": "Username already exists",
    "success": false
  }


HEALTH CHECK:
-------------
Request:
  GET /api/admin/health

Response (200 OK):
  "Admin API is running"


DEFAULT CREDENTIALS:
====================

Username:  admin
Password:  admin@12345

Change in: InitAdminUser.java line 29-30


AUTHENTICATION FLOW:
====================

ADMIN:
  Username/Password → /api/admin/login → Token (app.write) → Access Protected Endpoints

REGULAR USER:
  OAuth2 Authorization Code Flow → Token (app.read/app.write) → Access Regular Endpoints


IMPORTANT NOTES:
================

• Admins DO NOT use OAuth2 code flow
• Admins login directly with username/password
• Token returned contains scope="app.write"
• Admin users have ROLE_ADMIN
• Regular users have ROLE_USER
• All users assigned to appropriate UserGroup
• Passwords are encrypted with BCrypt
• Filters execute in order: AdminAuthenticationFilter → UsernamePasswordAuthenticationFilter
• CORS enabled for localhost:4200
• Admin endpoints are in whitelist


TROUBLESHOOTING:
================

Issue: "User is not an admin"
Fix: User must have role='ROLE_ADMIN' in database

Issue: "Invalid username or password"
Fix: Check credentials - default is admin/admin@12345

Issue: 403 Forbidden on create-user
Fix: First login with admin credentials to get valid token

Issue: CORS error from Angular
Fix: Admin endpoints already in CORS whitelist, check browser console

Issue: Database error on startup
Fix: Check that ADMIN_GROUP doesn't already exist with different config


CUSTOMIZATION CHECKLIST:
========================

Change default password:
  □ Edit InitAdminUser.java → ADMIN_PASSWORD

Change admin group name:
  □ Edit InitAdminUser.java → ADMIN_GROUP_NAME
  □ Edit AdminManagementService.java → ADMIN_GROUP_NAME

Implement JWT token:
  □ Edit AdminAuthenticationFilter.java → generateAdminToken()
  □ Add JWT dependency to pom.xml

Add audit logging:
  □ Edit AdminAuthenticationFilter.java → log login attempts
  □ Edit AdminManagementService.java → log user creation

Restrict admin creation:
  □ Edit AdminController.java → add conditions to @PreAuthorize

Add email verification:
  □ Edit AdminManagementService.java → add email validation
  □ Add email service integration

Add rate limiting:
  □ Add Spring Security rate limiting filter
  □ Configure in AppConfig.java


FILES TO REVIEW:
================

Core Implementation:
  ✓ InitAdminUser.java                    (startup initialization)
  ✓ AdminAuthenticationFilter.java        (login logic)
  ✓ AdminManagementService.java           (user creation logic)
  ✓ AdminController.java                  (REST endpoints)

Configuration:
  ✓ AuthorizationServerConfig.java        (security config)
  ✓ InitRegisteredClients.java            (OAuth2 setup)

Data Objects:
  ✓ AdminLoginRequest.java                (login request)
  ✓ AdminLoginResponse.java               (login response)
  ✓ AdminUserRequest.java                 (create user request)
  ✓ AdminUserResponse.java                (create user response)


TESTING WITH POSTMAN:
=====================

1. Create new POST request to http://localhost:8080/api/admin/login
2. Set Header: Content-Type: application/json
3. Set Body:
   {
     "username": "admin",
     "password": "admin@12345"
   }
4. Click Send
5. Copy the "token" from response
6. Create new POST request to http://localhost:8080/api/admin/create-user
7. Set Header: Content-Type: application/json
8. Set Header: Authorization: Bearer [paste token here]
9. Set Body with new admin details
10. Click Send


PRODUCTION READY:
=================

Before going to production:

✓ Change default admin password
✓ Implement real JWT token generation
✓ Enable HTTPS (configure SSL)
✓ Set up proper logging and audit trails
✓ Configure rate limiting for login endpoint
✓ Set up email notifications for admin creation
✓ Review security configuration
✓ Test with production database
✓ Update CORS origins from localhost:4200
✓ Configure admin dashboard redirect URLs

