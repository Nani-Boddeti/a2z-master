<div class="submit-ad-container">
  <div class="submit-ad-card">
    <h1>Submit Your Advertisement</h1>
    
    <!-- Success Message -->
    <div class="alert alert-success" *ngIf="successMessage">
      <svg class="alert-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
      {{ successMessage }}
    </div>

    <!-- Error Message -->
    <div class="alert alert-error" *ngIf="errorMessage">
      <svg class="alert-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      {{ errorMessage }}
    </div>

    <form [formGroup]="submitAdForm">
      <!-- Product Information Section -->
      <div class="form-section">
        <h2>Product Information</h2>
        
        <div class="form-group">
          <label>Product Name *</label>
          <input
            type="text"
            class="form-input"
            formControlName="productName"
            placeholder="Enter product name"
            [class.is-invalid]="submitAdForm.get('productName')?.invalid && submitAdForm.get('productName')?.touched"
          >
          <span class="error-text" *ngIf="submitAdForm.get('productName')?.invalid && submitAdForm.get('productName')?.touched">
            Product name is required (min 3 characters)
          </span>
        </div>
       <form [formGroup]="myForm" (ngSubmit)="onSubmit()">
          <!-- Regular inputs -->
          
          
          <!-- ✅ MAGIC: Single field like input -->
          <app-category-dropdown formControlName="category"></app-category-dropdown>

        </form>
        <div class="form-group">
          <label>Description *</label>
          <textarea
            class="form-input"
            formControlName="description"
            placeholder="Enter detailed product description"
            rows="5"
            [class.is-invalid]="submitAdForm.get('description')?.invalid && submitAdForm.get('description')?.touched"
          ></textarea>
          <span class="error-text" *ngIf="submitAdForm.get('description')?.invalid && submitAdForm.get('description')?.touched">
            Description is required (min 10 characters)
          </span>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Price *</label>
            <input
              type="number"
              step="0.01"
              class="form-input"
              formControlName="price"
              placeholder="0.00"
              [class.is-invalid]="submitAdForm.get('price')?.invalid && submitAdForm.get('price')?.touched"
            >
            <span class="error-text" *ngIf="submitAdForm.get('price')?.invalid && submitAdForm.get('price')?.touched">
              Valid price is required
            </span>
          </div>

          <div class="form-group">
            <label>Currency *</label>
            <select class="form-input" formControlName="currency">
              <option value="INR">INR (₹)</option>
              <option value="USD">USD ($)</option>
              <option value="EUR">EUR (€)</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" formControlName="isActive">
            <span>Mark as Active</span>
          </label>
        </div>
      </div>

      <!-- Media Upload Section -->
      <div class="form-section">
        <h2>Upload Media</h2>
        
        <div 
          class="file-upload-area"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)"
          [class.drag-over]="isDragOver"
        >
          <input
            type="file"
            #fileInput
            id="fileInput"
            (change)="onFileSelected($event)"
            multiple
            accept="image/*,video/*"
            class="file-input"
          >
          <label for="fileInput" class="file-upload-label" (click)="triggerFileInput(fileInput)">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="16 16 12 12 8 16"></polyline>
              <line x1="12" y1="12" x2="12" y2="21"></line>
              <path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"></path>
            </svg>
            <p class="upload-text">Click to select or drag files</p>
            <p class="upload-hint">Supported: Images & Videos</p>
          </label>
        </div>

        <div class="selected-files" *ngIf="selectedFiles.length > 0">
          <h3>Selected Files:</h3>
          <ul>
            <li *ngFor="let file of selectedFiles">
              <span>{{ file.name }}</span>
              <span class="file-size">{{ (file.size / 1024 / 1024).toFixed(2) }} MB</span>
            </li>
          </ul>
        </div>
      </div>

      <!-- Location/Address Section -->
      <div class="form-section">
        <h2>Your Location & Contact</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label>First Name *</label>
            <input
              type="text"
              class="form-input"
              formControlName="firstName"
              placeholder="First name"
              [class.is-invalid]="submitAdForm.get('firstName')?.invalid && submitAdForm.get('firstName')?.touched"
            >
          </div>

          <div class="form-group">
            <label>Last Name *</label>
            <input
              type="text"
              class="form-input"
              formControlName="lastName"
              placeholder="Last name"
              [class.is-invalid]="submitAdForm.get('lastName')?.invalid && submitAdForm.get('lastName')?.touched"
            >
          </div>
        </div>

        <div class="form-group">
          <label>Email *</label>
          <input
            type="email"
            class="form-input"
            formControlName="email"
            placeholder="email@example.com"
            [class.is-invalid]="submitAdForm.get('email')?.invalid && submitAdForm.get('email')?.touched"
          >
        </div>

        <div class="form-group">
          <label>Address Line 1 *</label>
          <input
            type="text"
            class="form-input"
            formControlName="line1"
            placeholder="Street address"
            [class.is-invalid]="submitAdForm.get('line1')?.invalid && submitAdForm.get('line1')?.touched"
          >
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Address Line 2</label>
            <input
              type="text"
              class="form-input"
              formControlName="line2"
              placeholder="Apartment, suite, etc."
            >
          </div>

          <div class="form-group">
            <label>Apartment</label>
            <input
              type="text"
              class="form-input"
              formControlName="apartment"
              placeholder="Apartment number"
            >
          </div>
        </div>

        <div class="form-group">
          <label>District *</label>
          <input
            type="text"
            class="form-input"
            formControlName="district"
            placeholder="City/District"
            [class.is-invalid]="submitAdForm.get('district')?.invalid && submitAdForm.get('district')?.touched"
          >
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Latitude * <span class="location-badge" *ngIf="!isLoadingLocation && submitAdForm.get('latitude')?.value">(Auto-detected)</span></label>
            <div class="location-input-group">
              <input
                type="number"
                step="0.000001"
                class="form-input"
                formControlName="latitude"
                placeholder="e.g., 17.3850"
                readonly
                [class.is-invalid]="submitAdForm.get('latitude')?.invalid && submitAdForm.get('latitude')?.touched"
              >
              <button type="button" class="btn-refresh" (click)="getLocationFromBrowser()" [disabled]="isLoadingLocation" title="Refresh location">
                <svg *ngIf="!isLoadingLocation" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23 4 23 10 17 10"></polyline>
                  <path d="M20.49 15a9 9 0 1 1-2-8.83"></path>
                </svg>
                <span *ngIf="isLoadingLocation" class="spinner"></span>
              </button>
            </div>
          </div>

          <div class="form-group">
            <label>Longitude * <span class="location-badge" *ngIf="!isLoadingLocation && submitAdForm.get('longitude')?.value">(Auto-detected)</span></label>
            <div class="location-input-group">
              <input
                type="number"
                step="0.000001"
                class="form-input"
                formControlName="longitude"
                placeholder="e.g., 78.4867"
                readonly
                [class.is-invalid]="submitAdForm.get('longitude')?.invalid && submitAdForm.get('longitude')?.touched"
              >
              <button type="button" class="btn-refresh" disabled style="visibility: hidden;">
                <span class="spinner"></span>
              </button>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Country Code *</label>
            <input
              type="text"
              class="form-input"
              formControlName="isoCode"
              placeholder="e.g., IND"
            >
          </div>

          <div class="form-group">
            <label>Region *</label>
            <input
              type="text"
              class="form-input"
              formControlName="region"
              placeholder="e.g., Asia"
            >
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="resetForm()"
          [disabled]="isSubmitting"
        >
          Reset
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="submitAd()"
          [disabled]="isSubmitting || submitAdForm.invalid"
        >
          <span *ngIf="!isSubmitting">Post Advertisement</span>
          <span *ngIf="isSubmitting">Submitting...</span>
        </button>
      </div>
    </form>
  </div>
</div>
