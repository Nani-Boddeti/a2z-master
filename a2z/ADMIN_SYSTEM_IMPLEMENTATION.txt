ADMIN USER SYSTEM - IMPLEMENTATION COMPLETE
============================================

ENDPOINTS CREATED:
==================

1. POST /api/admin/login
   - Direct username/password authentication (NO OAuth2 code flow)
   - Request: { "username": "admin", "password": "admin@12345" }
   - Response: { "success": true, "token": "...", "username": "...", "email": "...", "scope": "app.write" }
   - Returns token with app.write scope
   - Public endpoint (no authentication required)

2. POST /api/admin/create-user
   - Create new admin users dynamically
   - Requires: @PreAuthorize("hasRole('ROLE_ADMIN')")
   - Request body:
     {
       "username": "newadmin",
       "password": "SecurePass@123",
       "email": "newadmin@a2z.com",
       "firstName": "John",
       "lastName": "Doe",
       "phoneNumber": "+1234567890"
     }
   - Response: { "username": "newadmin", "email": "...", "success": true, "message": "..." }
   - Status: 201 (Created) or 400 (Error)

3. GET /api/admin/health
   - Health check for admin API
   - Response: "Admin API is running"
   - Public endpoint

FILES CREATED:
==============

Configuration:
- InitAdminUser.java
  - Creates default admin on app startup
  - Default: username=admin, password=admin@12345
  - Automatically creates ADMIN_GROUP

- InitRegisteredClients.java (MODIFIED)
  - Added admin-client OAuth2 registration
  - Scopes: app.read, app.write

Security:
- AdminAuthenticationFilter.java
  - Intercepts /api/admin/login requests
  - Validates admin credentials
  - Generates token with app.write scope
  - Returns error responses with proper HTTP status codes

Controllers:
- AdminController.java
  - REST endpoints for admin operations
  - Protected endpoints with @PreAuthorize

Services:
- AdminManagementService.java
  - Creates new admin users
  - Assigns to ADMIN_GROUP
  - Grants app.write scope

DTOs:
- AdminLoginRequest.java
- AdminLoginResponse.java
- AdminUserRequest.java
- AdminUserResponse.java

AUTHENTICATION FLOW:
====================

ADMIN LOGIN (Direct - No OAuth2):
1. POST /api/admin/login with { "username": "admin", "password": "admin@12345" }
2. AdminAuthenticationFilter intercepts request
3. Validates username exists and has ROLE_ADMIN
4. Verifies password using passwordEncoder
5. Checks if user is enabled
6. Generates token with app.write scope
7. Returns token in response

CREATE NEW ADMIN (Protected):
1. Admin calls POST /api/admin/create-user with new user details
2. Authorization header must contain valid admin token
3. AdminManagementService validates request
4. Creates new Customer with ROLE_ADMIN
5. Assigns to ADMIN_GROUP
6. Saves to database
7. Returns success/error response

ADMIN VS REGULAR USER:
======================

ADMIN:
- Direct login: /api/admin/login (username/password)
- No OAuth2 authorization code flow
- Scope: app.write (for admin operations)
- Can create new admin users
- Role: ROLE_ADMIN

REGULAR USER:
- OAuth2 authorization code flow
- Scope: app.read, app.write (depending on group)
- Standard user operations
- Role: ROLE_USER (by default)

KEY FEATURES:
=============

✓ Direct Admin Login (No OAuth2 Code Flow)
✓ Dynamic Admin User Creation via API
✓ Password Encryption (BCrypt)
✓ Admin-only Operations (@PreAuthorize)
✓ Automatic ADMIN_GROUP Creation
✓ Token Response with app.write Scope
✓ CORS Enabled for Admin Endpoints
✓ Public Health Check Endpoint
✓ Proper Error Handling (401, 403, 400)
✓ User Validation (disabled check, role check)

CUSTOMIZATION:
==============

1. Change default admin password:
   - Edit InitAdminUser.java → ADMIN_PASSWORD constant
   - Also edit ADMIN_EMAIL, ADMIN_PHONE constants

2. Change admin group name:
   - Edit InitAdminUser.java → ADMIN_GROUP_NAME constant
   - Edit AdminManagementService.java → ADMIN_GROUP_NAME constant (match them)

3. Integrate JWT token generation:
   - Edit AdminAuthenticationFilter.java → generateAdminToken() method
   - Replace with your JWT token generation logic

4. Add additional admin validation:
   - Edit AdminAuthenticationFilter.java → doFilterInternal() method
   - Add checks after role validation

5. Restrict admin creation further:
   - Edit AdminController.java → createAdminUser() method
   - Enhance @PreAuthorize conditions

SECURITY NOTES:
===============

- Passwords are encoded using Spring Security's PasswordEncoder (BCrypt)
- Admin credentials are never logged or exposed in responses
- Admin login is direct (no intermediate authentication steps)
- Admin creation requires existing admin authentication
- User disabled status is checked during login
- CSRF protection disabled for admin login (stateless)
- CORS configured for localhost:4200

DATABASE:
=========

Customer table:
- userName (PK)
- password (encoded)
- email
- role (ROLE_ADMIN or ROLE_USER)
- firstName, lastName
- phoneNumber
- disabled flag

UserGroup table:
- Groups users together
- ADMIN_GROUP created automatically
- Maps to scopes/permissions

usergroup_customer (M2M):
- Links customers to user groups
- Admin assigned to ADMIN_GROUP on creation

TESTING THE ENDPOINTS:
======================

Using curl:

1. Login as admin:
curl -X POST http://localhost:8080/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin@12345"}'

2. Create new admin (replace TOKEN with response token):
curl -X POST http://localhost:8080/api/admin/create-user \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TOKEN" \
  -d '{
    "username":"newadmin",
    "password":"SecurePass@123",
    "email":"newadmin@a2z.com",
    "firstName":"John",
    "lastName":"Doe",
    "phoneNumber":"+1234567890"
  }'

3. Check health:
curl http://localhost:8080/api/admin/health

LOGS ON STARTUP:
================

When application starts, you should see:
→ Creating admin user: admin
  ✓ Created new admin group: ADMIN_GROUP
✓ Admin user created successfully
  Username: admin
  Email: admin@a2z.local
  User Group: ADMIN_GROUP
  Role: ROLE_ADMIN

If admin already exists:
✓ Admin user already exists: admin

